# インフラ構成設計書

## 1. システム構成図

```mermaid
graph TB
    Client[クライアント]
    Web[Webサーバー]
    DB[(SQLite DB)]

    Client --> Web
    Web --> DB
```

## 2. 環境構成

### 開発環境

- ローカル開発環境
  - Python 3.x
  - Flask 開発サーバー
  - SQLite データベース

### テスト環境

- CI/CD 環境（GitHub Actions）
- テスト用データベース
- 自動テスト実行環境

### 本番環境

- Web サーバー: Nginx + gunicorn
- データベース: SQLite
- バックアップシステム

## 3. サーバー構成

### Web サーバー

- Nginx + gunicorn
- スペック
  - CPU: 2 vCPU
  - メモリ: 4 GB
  - ディスク: 50 GB SSD

### データベース

- SQLite
- ファイルベース
- 定期バックアップ

## 4. セキュリティ設定

### Web サーバー設定

- HTTPS/SSL 対応
- セキュリティヘッダーの設定
- アクセス制限

### アプリケーションセキュリティ

- CSRF 対策
- XSS 対策
- SQL インジェクション対策
- セッション管理

## 5. バックアップ設計

### データベースバックアップ

- 日次フルバックアップ
- バックアップファイルの暗号化
- 30 日間保持

### ログバックアップ

- アプリケーションログ: 90 日保持
- アクセスログ: 90 日保持
- エラーログ: 90 日保持

## 6. 監視設計

### 監視項目

- サーバーリソース（CPU、メモリ、ディスク）
- アプリケーション状態
- エラーログ
- アクセスログ

### アラート設定

- サーバーダウン検知
- エラー率の閾値超過
- ディスク使用率の警告

## 7. デプロイメントフロー

```mermaid
graph LR
    Dev[開発環境] --> Test[テスト環境]
    Test --> Staging[ステージング環境]
    Staging --> Prod[本番環境]
```

### デプロイ手順

1. ソースコードのプッシュ
2. 自動テストの実行
3. テスト環境へのデプロイ
4. 動作確認
5. 本番環境へのデプロイ

## 8. 開発環境セットアップ

### 必要なソフトウェア

- Python 3.x
- pip
- Git
- Visual Studio Code（推奨）

### ローカル環境構築手順

1. リポジトリのクローン
2. 仮想環境の作成
3. 依存パッケージのインストール
4. データベースの初期化
5. 開発サーバーの起動
