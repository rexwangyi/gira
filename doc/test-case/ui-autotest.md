# UI 自動化テスト設計

## 1. 概要

Selenium を使用した E2E テストを実装し、ユーザーの実際の操作をシミュレートしてアプリケーションの機能を検証します。

## 2. テストケース一覧

### 2.1 機能テスト一覧

| ID  | テスト項目     | テストケース                                  | 前提条件     | 期待結果                             |
| --- | -------------- | --------------------------------------------- | ------------ | ------------------------------------ |
| L1  | ログイン失敗   | 無効なユーザー名とパスワードでログイン        | -            | エラーメッセージが表示される         |
| L2  | ログイン成功   | 有効なユーザー名とパスワードでログイン        | -            | バックログページにリダイレクト       |
| B1  | バックログ操作 | ストーリーをバックログからスプリント 2 へ移動 | ログイン済み | スプリント 2 のストーリー数が 1 増加 |
| B2  | バックログ操作 | ストーリーをスプリント 2 からバックログへ移動 | B1 の実行後  | スプリント 2 のストーリー数が 1 減少 |
| K1  | かんばん操作   | ストーリーを Todo から In Progress へ移動     | ログイン済み | In Progress のストーリー数が 1 増加  |
| K2  | かんばん操作   | ストーリーを In Progress から Done へ移動     | K1 の実行後  | Done のストーリー数が 1 増加         |
| K3  | かんばん操作   | ストーリーを Done から Todo へ移動            | K2 の実行後  | Todo のストーリー数が 1 増加         |
| N1  | 画面遷移       | かんばんボードへ遷移                          | ログイン済み | かんばんボード画面が表示される       |
| O1  | ログアウト     | ログアウトリンクをクリック                    | ログイン済み | ログイン画面にリダイレクト           |

### 2.2 テストシーケンス

| 順序 | テスト ID | 説明                      | 確認項目           |
| ---- | --------- | ------------------------- | ------------------ |
| 1    | L1        | 無効なログイン            | エラーメッセージ   |
| 2    | L2        | 有効なログイン            | リダイレクト       |
| 3    | B1        | バックログ → スプリント 2 | ストーリー数の増加 |
| 4    | B2        | スプリント 2→ バックログ  | ストーリー数の減少 |
| 5    | N1        | かんばんボードへ遷移      | 画面表示           |
| 6    | K1        | Todo→In Progress          | ストーリー数の変化 |
| 7    | K2        | In Progress→Done          | ストーリー数の変化 |
| 8    | K3        | Done→Todo                 | ストーリー数の変化 |
| 9    | O1        | ログアウト                | リダイレクト       |

## 3. 実装の特徴

### 3.1 安定性向上策

| 項目               | 実装内容             | 目的                     |
| ------------------ | -------------------- | ------------------------ |
| 待機処理           | WebDriverWait の使用 | 要素の表示を確実に待機   |
| リトライ機能       | 最大 3 回の再試行    | 一時的なエラーから回復   |
| エラーハンドリング | 例外捕捉とログ出力   | 問題の特定と分析を容易に |
| スクリーンショット | エラー時に自動保存   | 問題発生時の状態を記録   |

### 3.2 ドラッグ＆ドロップ実装

| イベント          | 目的            | 実装方法                   |
| ----------------- | --------------- | -------------------------- |
| dragstart         | ドラッグ開始    | DragEvent をディスパッチ   |
| dragover          | ドラッグ中      | DragEvent をディスパッチ   |
| drop              | ドロップ完了    | DragEvent をディスパッチ   |
| sortablejs:change | SortableJS 通知 | CustomEvent をディスパッチ |

### 3.3 テスト結果管理

| 項目               | 内容               | 保存場所            |
| ------------------ | ------------------ | ------------------- |
| 操作ログ           | 詳細な操作内容     | logs/app.log        |
| エラーログ         | エラー情報と例外   | logs/app.log        |
| スクリーンショット | エラー発生時の画面 | tests/result/\*.png |

## 4. 実行環境

### 4.1 必要な環境

| 項目      | 要件              | 備考                     |
| --------- | ----------------- | ------------------------ |
| Python    | 3.x 以上          | 3.8 以上推奨             |
| ブラウザ  | Chrome            | 最新版推奨               |
| WebDriver | ChromeDriver      | ブラウザと同じバージョン |
| OS        | Windows/Mac/Linux | -                        |

### 4.2 必要なパッケージ

| パッケージ名      | バージョン | 用途           |
| ----------------- | ---------- | -------------- |
| selenium          | 4.x        | ブラウザ操作   |
| webdriver_manager | 最新       | WebDriver 管理 |

### 4.3 実行前の準備

| 項目           | 確認内容                     | 備考 |
| -------------- | ---------------------------- | ---- |
| サーバー       | http://127.0.0.1:5000 で起動 | -    |
| データベース   | テストデータが準備済み       | -    |
| テストユーザー | admin/admin123 が利用可能    | -    |

## 5. 既知の制限事項

| ID  | 制限事項             | 影響               | 対処方法              |
| --- | -------------------- | ------------------ | --------------------- |
| L1  | カウント表示の非更新 | UI 表示のみ        | 画面リロードで最新化  |
| L2  | 複数要素の重なり     | ドラッグ＆ドロップ | JavaScript で直接操作 |
